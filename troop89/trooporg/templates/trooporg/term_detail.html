{% extends "base_unary.html" %}
{% load staticfiles %}

{% block title %}Members{% endblock %}

{% block description %}{% if term %}Troop 89 Member {{ term.period_str }}{% else %}No records for this term.{% endif %}{% endblock %}

{% block info_banner %}<h1>Members</h1>{% endblock %} info_banner %}

{% block content_main %}
    {% if term %}
        <div class="members-header">
            <h1 class="title">{{ term.period_str }}</h1>
            {% if term.nickname %}
                <span class="meta">&quot;{{ term.nickname }}&quot;</span>
            {% endif %}
        </div>
        <section>
        {% if term.position_instances.all %}
            {% regroup term.position_instances.all by grouping_name as position_groups %}
            {% for group in position_groups %}
                <h2>{{ group.grouper }}</h2>
                <ul>
                {% for position in group.list %}
                    <li>{{ position.type.title }} - {{ position.incumbent }}</li>
                {% endfor %}
                </ul>
            {% endfor %}
        {% else %}
            No positions for this term.
        {% endif %}
        </section>
        <section>
            <h2>Patrols</h2>
                {% regroup term.patrol_memberships.all by patrol as patrol_map %}
                {% spaceless %}{% for patrol in patrol_map %}
                    <div class="patrol-bubble col-3">
                        <header class="bubble-header">
                        <span class="title">
                            <a href="{{ patrol.grouper.get_absolute_url }}">{{ patrol.grouper.name }} Patrol</a>
                        </span>
                        {{ patrol.list|length }} Members
                    </header>
                    {% include "trooporg/includes/patrol-members.html" with memberships=patrol.list %}
                    </div>
                {% endfor %}{% endspaceless %}
        </section>
    {% else %}
        {# Todo: revise to include link to term archive. #}
        <p> There are no records for {{ date|date:"M d Y" }}</p>
    {% endif %}
{% endblock %}
